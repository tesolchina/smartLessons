<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKBU Basic Chat Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/chat.css">
</head>
<body>
     <div class="container">
    <button id="sidebar-toggle" class="sidebar-toggle-btn">
        <span class="toggle-icon">‚öôÔ∏è</span>
    </button>
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ü§ñ Chatbot Configuration</h2>

            </div>
            
            <div class="sidebar-content">
            <!-- Replace the existing API configuration section with this -->
            <div class="api-section">
                <div class="api-header" onclick="toggleSection('api')">
                    <h3>üîë API Configuration</h3>
                    <span class="toggle-icon" id="api-toggle">‚ñº</span>
                </div>
                <div class="api-content" id="api-content">
                    <div class="api-instructions">
                        <p>Enter your HKBU GenAI API key to start chatting:</p>
                    </div>
                    
                    <div class="input-group">
                        <label for="api-key">API Key:</label>
                        <input type="password" id="api-key" class="api-key-input" placeholder="Enter your API key">
                    </div>
                    
                    <div class="input-group">
                        <label for="model-select">Model:</label>
                        <select id="model-select">
                            <option value="gpt-4.1-mini">GPT-4.1 Mini</option>
                            <option value="gpt-4.1">GPT-4.1</option>
                            <option value="claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                        </select>
                    </div>
                    
                    <div class="api-buttons">
                        <button onclick="testConnection()" class="btn btn-secondary">Test Connection</button>
                        <button id="connect-btn" onclick="connectAPI()" class="btn btn-primary" disabled>Connect</button>
                        <button onclick="clearAPI()" class="btn btn-danger">Clear API</button>
                    </div>
                    
                    <div id="connection-status" class="connection-status" style="display: none;"></div>
                </div>
            </div>

            <!-- Welcome Prompt Section -->
                <div class="prompt-section">
                    <div class="prompt-header" onclick="togglePrompt('welcome')">
                        <h3>üìù Welcome Message</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="prompt-content" id="welcome-content">
                        <div class="prompt-display" id="welcome-display">Loading welcome message from file...</div>
                        <button class="btn btn-primary" onclick="editPrompt('welcome')">Edit Welcome</button>
                        <button class="btn btn-secondary" onclick="resetPrompt('welcome')">Reset</button>
                    </div>
                </div>

            <!-- System Prompt Section -->
                <div class="prompt-section">
                    <div class="prompt-header" onclick="togglePrompt('system')">
                        <h3>‚öôÔ∏è System Instructions</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="prompt-content" id="system-content">
                        <div class="prompt-display" id="system-display">Loading system instructions from file...</div>
                        <div class="prompt-actions">
                            <button class="btn btn-primary" onclick="handleSystemPromptEdit()">‚úèÔ∏è Edit System</button>
                            <button class="btn btn-secondary" onclick="resetPrompt('system')">‚Ü∫ Reset</button>
                            <button class="btn btn-info" onclick="startNewSession()">üîÑ New Session</button>
                        </div>
                        <div class="prompt-hint" style="margin-top: 10px;">
                            <small class="text-gray-600 dark:text-gray-400">
                                üí° Example roles:
                                <span class="role-tag" onclick="handleRoleTagClick('Math Tutor')">Math Tutor</span>
                                <span class="role-tag" onclick="handleRoleTagClick('Writing Coach')">Writing Coach</span>
                                <span class="role-tag" onclick="handleRoleTagClick('Research Assistant')">Research Assistant</span>
                                <span class="role-tag" onclick="handleRoleTagClick('Language Partner')">Language Partner</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>


        
        </div>
    </div>

    <!-- Credits Footer -->
    <div class="sidebar-footer">
        <strong>Created by:</strong><br>
        Dr. Simon Wang<br>
        Innovation Officer, Language Centre<br>
                Hong Kong Baptist University<br>
                <a href="mailto:simonwang@hkbu.edu.hk" style="color: #667eea;">simonwang@hkbu.edu.hk</a>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-header-main">
                    <h1>HKBU Learning Assistant</h1>
                    <div style="font-size: 0.9rem; opacity: 0.9;">
                        üí° Customize prompts, chat, and generate learning reports
                    </div>
                </div>
                <button class="new-session-btn" onclick="startNewSession()">
                    <span class="btn-icon">üîÑ</span>
                    New Session
                </button>
            </div>

            <div class="chat-messages" id="chat-messages">
                <div class="message assistant">
                    <div class="message-content">
                        üîë Please configure your API key first to start chatting!<br><br>
                        Follow the instructions in the sidebar to get your HKBU GenAI API key and test the connection.
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="message-input" 
                        placeholder="Connect your API key first to start chatting..."
                        rows="1"
                        disabled
                    ></textarea>
                    <div class="input-buttons">
                        <button class="send-btn" id="send-btn" onclick="sendMessage()" disabled title="Send Message">
                            ‚û§
                        </button>
                        <button class="done-btn" id="done-btn" onclick="generateReport()" disabled title="Generate Report">
                            ‚úì
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="report-modal" id="report-modal">
        <!-- ... report modal content ... -->
    </div>

    <!-- Prompt Edit Modal -->
    <div class="prompt-edit-modal" id="prompt-edit-modal">
        <div class="prompt-edit-content">
            <div class="prompt-edit-header">
                <h3 id="prompt-edit-title">Edit Prompt</h3>
                <button class="close-btn" onclick="closePromptEdit()">&times;</button>
            </div>
            <textarea id="prompt-edit-textarea" class="prompt-edit-textarea"></textarea>
            <div class="prompt-edit-buttons">
                <button class="btn btn-success" onclick="savePromptEdit()">Save Changes</button>
                <button class="btn btn-secondary" onclick="closePromptEdit()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/prompts.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>